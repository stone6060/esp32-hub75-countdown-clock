# esp32-hub75-countdown-clock


- 待办：
  - 用户&时钟代码端：增加线上设备标签，增加选择设备功能
  - PCB绘制：修改pcb转接板，采用控制+转接2块板，实现更好的模块化
  - 外壳模型：修改模型使时钟外壳强度合适且成本最低
  - 用户&时钟代码端：适配校园网登陆界面


## 用户界面构建

 使用python代码构建用户GUI界面，在代码中，tkinter库用于创建GUI界面，易于用户使用，使用csv文件储存倒计时时间及时长，便于查看和编辑，每次打开时从csv文件中加载数据，并通过Serial（串口）库或WIFI库与esp32进行通信，用于控制esp32时钟。  
- 开发概况：基于 Python 原生 Tkinter 库开发，实现了跨平台、无额外依赖的轻量级控制台。
- 交互设计：采用“连接-管理-同步”的流程式操作。通过下拉菜单管理不同日期区间的方案，配合Treeview列表直观展示每日任务，最大化利用屏幕空间。
- 逻辑健壮性：内置了严格的数据校验机制（日期/时间格式正则校验、任务时间重叠检测、日期区间冲突检测），确保发送至下位机的数据绝对合规，降低下位机解析负担。
- 通信稳定性：针对 ESP32 开发板特性，在串口连接逻辑中增加了 DTR/RTS 信号控制，防止了打开串口导致设备意外复位的问题，保障了连接的稳定性。
- 使用标准 CSV 格式在本地存储 countdown_data.csv (任务表) 和 wifi_config.csv (配置信息)。软件启动时自动读取加载，实现了配置记忆功能。
- 增加mqttx服务器，通过网络实现全时全域控制时钟

## 时钟代码构建

 - 核心驱动：DMA库首次构建时出现花屏问题，改用占用 CPU 极高的传统“位以此”翻转（Bit-banging）驱动，并手写驱动库确保led屏正常显示所需字符，但该方法占用cpu资源过多且与NTP授时方法冲突，从而重新采用 ESP32-HUB75-MatrixPanel-I2S-DMA 库。利用 ESP32 的 DMA（直接存储器访问）硬件特性驱动屏幕，释放 CPU 算力用于处理 WiFi 和业务逻辑，彻底解决了“亮屏即断网”和“刷新闪烁”的冲突。
- 成本与硬件优化：
  - 移除 RTC 模块：利用 WiFi 连接阿里云 NTP 服务器进行网络授时，软件补偿网络延迟，省去了 DS3231 实时时钟模块，降低硬件成本。
  - 移除 SD 卡模块：利用 ESP32 内置的 SPIFFS（文件系统） 存储 CSV 格式的倒计时计划和 WiFi 配置，实现掉电数据不丢失，无需外挂存储。在 ESP32 的 Flash 闪存中划分出 SPIFFS 分区。通过串口接收到的 CSV 数据流被直接写入 Flash 文件。系统重启后，优先读取 Flash 中的 CSV 文件解析任务列表，保证了断网断电后的业务连续性。
  - 系统稳定性：痛点：ESP32 的 WiFi 射频电路启动时会占用 ADC2 通道（对应 GPIO 25/26/27），导致这些引脚上的屏幕信号（R1/G1/B1）被切断，出现“上半屏缺色/乱码”。先启动 WiFi (WiFi.begin) 并等待连接。连接成功后，强制关闭 WiFi 节能模式 (WiFi.setSleep(false))，锁定 CPU 频率和引脚状态。调用 driver/dac.h 强制禁用 DAC，释放 GPIO 25。最后初始化屏幕 (dma_display->begin())，重新配置引脚寄存器，夺回控制权。
- 字模转译：画出0-9字模并单独存储，降低主程序负载，增强代码可读性

## 电路连接与引脚规划

极简化，模块化绘制pcb，更容易排查问题，且批量化生产步骤更简洁（在smt贴片后需要人工的步骤仅需插好排线）
pcb绘制细节：
 - 避开 PSRAM：弃用 GPIO 16/17 (常用于片外内存)，改用 GPIO 18/19 等 VSPI 接口作为高速数据线，保证了高速信号的完整性。
 - 避开 Boot 脚：避开 GPIO 0/2 等影响启动模式的引脚。
 - 电源完整性：强调 GND 共地 设计，LED 屏独立供电（5V 2A），避免电流过大击穿控制板， ESP32 的 LDO 稳压芯片因过热保护而重启。

## 外壳模型绘制

使用sw软件绘制外壳
